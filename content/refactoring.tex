\chapter{Refactoring of mkfs.xfs} \label{chap:refactoring}
As is shown in~\ref{chap:xfs:mkfs}, the situation was not ideal and the state of the code led to many known issues. David Chinner, then maintainer of XFS, presented a set of patches as a request for comment (RFC) in November 2013~\cite{davidsPatches} in an attempt to raise a discussion, however, nobody joined it and David Chinner himself didn't continued in pressing this matter for few years.

When I joined the XFS team and began with the refactoring in 2015~\cite{myFirstPatches}, I picked up this patchset and brought it up to date with the codebase that in some parts changed substantially in the two years. Then I continued when David Chinner left off, fixing issues with his patches and adding further changes. This first part took until May 2016, when it was merged into the upstream repository~\cite{finalPatchset1,finalPatchset1Announce}.

Once this change was merged and provided a stable point so I didn't had to keep so much code in my own local repository up to date with upstream, I began to work on the second set of changes. I submitted a RFC of these changes in December 2016~\cite{secondSetRFC} and as of now, I'm awaiting a review. Such a big and complex changes are usually reviewed only by the maintainer who changed in late December -- Eric Sandeen took this position instead of David Chinner. This probably caused some delay.

\section{First patchset}\label{chap:refactoring:first}





%==================================
% (c) Jan Tulak, 2017
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Results}\label{chap:results}
%----------------------------------------------------------------------

In this chapter, the results of every tool are compared and analysed. In
\Cref{tab:results:overview} is a summary of how many issues every tool
found. If not stated otherwise, the number of issues is for mkfs-specific
files, i.e., for files in {\tt mkfs/} directory.

\begin{table}[h]
\begin{tabular}{|r||r|r|r|r|r|r|}
\hline
Commit & CppCheck & Codacy & CPAChecker & Coverity & GCC & Clang \\
\hline
\hline
\multicolumn{7}{|c|}{Total issues}\\
\hline
(tag: v4.11.0-rc1) {\tt 07a3e793} & $1$ & $3$ & & & $30$ & $34$ \\
\hline
(tag: v4.7.0) {\tt d7e1f5f1} & $1$ & $4$ & & & $30$ & $28$ \\
\hline
\hline
\multicolumn{7}{|c|}{Changes}\\
\hline
{\em [Last of my set]} {\tt 2aca16d6} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt aa3034d4} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt 6de2e6c0} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt ddc3b2da} & 0 & 0 & & & 0 & 0\\
\hline
{\tt 06ac92fd} & 0 & 0 & & & $+1$ & $+1$\\
\hline
{\tt 27ae3a59} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt 3ec1956a} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt 6c855628} & 0 & 0 & & & $-2$ & $-2$ \\
\hline
{\tt 627e74fd} & $-3$ & $-2$ & & & $+2$ & $+2$ \\
\hline
{\tt 9090e187} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt 1974d3f1} & 0 & 0 & & & $-1$ & 0 \\
\hline
{\tt 56e4d368} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt a9dad670} & 0 & 0 & & & $-54$ & $-54$ \\
\hline
{\tt 147e0f31} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt c81c8460} & 0 & 0 & & & $-50$ & $-50$ \\
\hline
{\tt a887c950} & 0 & 0 & & & $+13$ & $+12$ \\
\hline
{\tt 5f1a2100} & 0 & 0 & & & 0 & 0 \\
\hline
{\tt ff21c709} & 0 & 0 & & & $+1$ & $+1$ \\
\hline
{\em [First of my set]} {\tt 4a32b9e9} & $-1$ & $-1$ & & & 0 & 0 \\
\hline
\hline
\multicolumn{7}{|c|}{Total issues} \\
\hline
{\em [Before my set]} {\tt 6aa32b47} & $5$ & $6$ & & & $121$ & $117$ \\
\hline
(4.6.0) {\tt 09033e35} & $5$ & $6$ & & & $121$ & $117$ \\
\hline
\end{tabular}
\caption{An overview of issues found by the tested tools on specific
	revisions in mkfs-only files.\newline
	\newline
	Legend: Revisions annotated with {\em total issues} shows the
	number of outstanding issues. All other revisions shows new/fixed
	issues.  $+x$ denotes amount of new issues found, $-x$ denotes number
	of issues fixed between this and the previously tested revision. The
	numbers are absolute, that is, 0 means no change, $+1$ means one new
	issue and $+1$/$-2$ means one new and two removed. A --- dash means that
	the tool was not used on this specific revision.}


\label{tab:results:overview}
\end{table}

%======================================================================
\section{CppCheck}\label{chap:results:cppcheck}
%----------------------------------------------------------------------
CppCheck (and Codacy, which is using it) found less issues than other
tools. When the kind of issues found is analysed, it becomes apparent that
this tool is greatly limited.

When compared with Codacy, CppCheck reports one issue twice: Checking if an
unsigned variable is less than zero. This happens on two places, but Codacy
ignores the second occurrence. On the other side, CppCheck did not find any
issue in {\tt mkfs/proto.c} file, where Codacy did.

These differences might be caused by a different configuration of CppCheck,
because we used the default configuration, but do not know what changes
Codacy did.

Despite of this, the results are very similar when compared to other tools,
so we use only CppCheck in further comparison with other tools. CppCheck is
selected because we have greater control over it, unlike cloud service Codacy.

\TODO{Should I run it on whole xfsprogs? How? Will it manage a list of
files to parse without any organisation? Try to bundle it with csbuild?}

% ------------------------------------------------
\subsection{Version 4.11-rc1 and 4.7.0}
An overview of issues at these revisions.
\begin{table}[h]
\begin{tabular}{|l||r||r|}
\hline
& {\tt mkfs/xfs\_mkfs.c} & Whole xfsprogs \\
\hline
Issues & 1 &  \\
\hline
\end{tabular}
\caption{In mkfs-specific files, 1 issue was found.}
%\label{tab:results:overview}
\end{table}

The issues found in mkfs is:
\begin{enumerate}
	\item {\tt mkfs/xfs\_mkfs.c}: The scope of the variable 'bucket' can be reduced.
\end{enumerate}

% ------------------------------------------------
\subsection{Version 627e74fd}
These 3 issues were fixed mkfs:
\begin{enumerate}
	\item {\tt mkfs/xfs\_mkfs.c}: Checking if unsigned variable 'blocksize' is less than zero.
	\item {\tt mkfs/xfs\_mkfs.c}: Checking if unsigned variable
		'sectorsize' is less than zero. {\em This issue appears
		twice.}
\end{enumerate}


% ------------------------------------------------
\subsection{Version 4a32b9e9}
This 1 issue was fixed in mkfs:
\begin{enumerate}
	\item {\tt mkfs/xfs\_mkfs.c}: Condition '0' is always false
\end{enumerate}


% ------------------------------------------------
\subsection{Version 4.6.0}
An overview of issues at this revision.
\begin{table}[h]
\begin{tabular}{|l||r||r|}
\hline
& {\tt mkfs/xfs\_mkfs.c} & Whole xfsprogs \\
\hline
Issues & 5 &  \\
\hline
\end{tabular}
\caption{In mkfs-specific files, 1 issue was found.}
%\label{tab:results:overview}
\end{table}

The issues found in mkfs is:
\begin{enumerate}
	\item {\tt mkfs/xfs\_mkfs.c}: Checking if unsigned variable 'blocksize' is less than zero.
	\item {\tt mkfs/xfs\_mkfs.c}: Checking if unsigned variable
		'sectorsize' is less than zero. {\em This issue appears
		twice.}
	\item {\tt mkfs/xfs\_mkfs.c}: Condition '0' is always false
	\item {\tt mkfs/xfs\_mkfs.c}: The scope of the variable 'bucket' can be reduced.
\end{enumerate}

All these issues were present for multiple years. Precise dating is
difficult, however, because e.g. issue 1 is blamed to a commit 16 years
old. But at that time, the variable was signed. Thus, the issue appeared
some time later, when the specific variable was turned to unsigned, but not
every use was fully converted.

Neither of these issues is of any seriousness. Every found check of an
unsigned variable to being lower than zero is in fact a less-or-equal
check. Thus, {\tt unsigned\_variable <= 0} may be misleading, but
functionally is equivalent to {\tt unsigned\_variable == 0}.
The condition '0' is a value intentionally passed to a macro.


%======================================================================
\section{Codacy}\label{chap:results:codacy}
%----------------------------------------------------------------------
Codacy shows only per-commit and total issues for a branch. That is, a
developer can view whether a specific commit fixed or caused an issue, and
can see what are the issues for the top of the repository, but checking the
complete state on a particular point in the history requires creating a new
branch, which is uncomfortable, but manageable for a private\footnote{In
the sense of being the only user, not in terms of visibility.} repository.
In a repository with many contributors it can be confusing.

Codacy provides some rating on the project's page~\cite{codacyXfsprogs},
which considers xfsprogs as a quality project (A-grade), but the weight of
this rating is unclear and rather informal.

For comparison with other tools, see introduction of \Cref{chap:results:cppcheck}.

% ------------------------------------------------
\subsection{Version 4.11-rc1}
An overview of issues at this revision.
\begin{table}[h]
\begin{tabular}{|l||r|r||r|}
\hline
& {\tt mkfs/xfs\_mkfs.c} & {\tt mkfs/proto.c} & Whole xfsprogs \\
\hline
Issues & 1 & 2 & 937 \\
\hline
\end{tabular}
\caption{In mkfs-specific files, 3 issues were found. Whole
xfsprogs had 937 issues, from which 900 were code style issue, 36 were
potential errors and 1 was a security issue.}
%\label{tab:results:overview}
\end{table}

The issues found in mkfs are:
\begin{enumerate}
	\item {\tt mkfs/xfs\_mkfs.c}: The scope of the variable 'bucket' can be reduced.
	\item {\tt mkfs/proto.c}: The function 'setup\_proto' is never used.
	\item {\tt mkfs/proto.c}: The function 'parse\_proto' is never used.
\end{enumerate}

% ------------------------------------------------
\subsection{Version 4.7.0}
An overview of issues at this revision.
\begin{table}[h]
\begin{tabular}{|l||r|r|r||r|}
\hline
& {\tt mkfs/xfs\_mkfs.c} & {\tt mkfs/maxtrres.c} & {\tt mkfs/proto.c} & Whole xfsprogs \\
\hline
Issues & 1 & 1 & 2 & 749 \\
\hline
\end{tabular}
\caption{In mkfs-specific files, 4 issues were found. Whole
xfsprogs had 749 issues, from which 719 were code style issue and 30 were
potential errors.}
%\label{tab:results:overview}
\end{table}

The issues found in mkfs are:
\begin{enumerate}
	\item {\tt mkfs/xfs\_mkfs.c}: The scope of the variable 'bucket' can be reduced.
	\item {\tt mkfs/maxtrres.c}: The function 'max\_trans\_res' is never used.
	\item {\tt mkfs/proto.c}: The function 'setup\_proto' is never used.
	\item {\tt mkfs/proto.c}: The function 'parse\_proto' is never used.
\end{enumerate}

% ------------------------------------------------
\subsection{Revision 627e74fd}
Fixed 2 issues in {\tt mkfs/xfs\_mkfs.c}:

\begin{enumerate}
\item Checking if unsigned variable 'blocksize' is less than zero. (line 1579)
\item Checking if unsigned variable 'sectorsize' is less than zero. (line
								     1705)
\end{enumerate}

% ------------------------------------------------
\subsection{Version 4.6.0}

An overview of issues at this revision.
\begin{table}[h]
\begin{tabular}{|l||r|r||r|}
\hline
& {\tt mkfs/xfs\_mkfs.c} & {\tt mkfs/proto.c} & Whole xfsprogs \\
\hline
Issues & 4 & 2 & 839 \\
\hline
\end{tabular}
\caption{In mkfs-specific files, 6 issues were found. Whole
xfsprogs had 839 issues, from which 809 were code style issue and 30 were
potential errors.}
%\label{tab:results:overview}
\end{table}

The issues found in mkfs are:
\begin{enumerate}
	\item {\tt mkfs/xfs\_mkfs.c}: Checking if unsigned variable 'blocksize' is less than zero.
	\item {\tt mkfs/xfs\_mkfs.c}: Checking if unsigned variable 'sectorsize' is less than zero.
	\item {\tt mkfs/xfs\_mkfs.c}: Condition '0' is always false
	\item {\tt mkfs/xfs\_mkfs.c}: The scope of the variable 'bucket' can be reduced.
	\item {\tt mkfs/proto.c}: The function 'setup\_proto' is never used.
	\item {\tt mkfs/proto.c}: The function 'parse\_proto' is never used.
\end{enumerate}



%======================================================================
\section{CPAChecker}\label{chap:results:cpachecker}
%----------------------------------------------------------------------

%======================================================================
\section{Coverity}\label{chap:results:coverity}
%----------------------------------------------------------------------

%======================================================================
\section{GCC}\label{chap:results:gcc}
%----------------------------------------------------------------------


%======================================================================
\section{Clang}\label{chap:results:clang}
%----------------------------------------------------------------------

%======================================================================
\section{Summary}\label{chap:results:summary}
%----------------------------------------------------------------------

